import React, { useState, useEffect } from 'react'
import { createFileRoute, Link } from '@tanstack/react-router'
// Importa o novo TIPO de paciente
import type { Patient } from '../../../lib/types' 
// Importa os componentes de Card e Input
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
} from "../../../components/ui/card"
import { Input } from "../../../components/ui/input"
// Importa o ícone de Busca (da mesma biblioteca do 'Bell' na NavBar)
import { Search } from 'lucide-react'

// 1. Define os dados mockados (substitua pela sua API)
const MOCK_PATIENTS: Patient[] = [
  { id: 1, name: 'Ana Silva', dob: '15/03/1988', gender: 'Feminino', phone: '(11) 98765-4321', email: 'ana.silva@email.com' },
  { id: 2, name: 'Carlos Pereira', dob: '22/07/1975', gender: 'Masculino', phone: '(11) 91234-5678', email: 'carlos.pereira@email.com' },
  { id: 3, name: 'Beatriz Costa', dob: '10/11/1992', gender: 'Feminino', phone: '(11) 94567-8901', email: 'beatriz.costa@email.com' },
  { id: 4, name: 'Ricardo Almeida', dob: '05/01/1980', gender: 'Masculino', phone: '(11) 92345-6789', email: 'ricardo.almeida@email.com' },
  { id: 5, name: 'Fernanda Lima', dob: '18/09/1995', gender: 'Feminino', phone: '(11) 97890-1234', email: 'fernanda.lima@email.com' },
];

// 2. Cria a rota para esta página
// O TanStack vai transformar isto na rota '/patients'
export const Route = createFileRoute('/_doctor/patients/index/tsx')({
  component: PatientsPage, // Define o componente da página
})

// 3. Define o componente da página
function PatientsPage() {
  const [patients, setPatients] = useState<Patient[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  // Simula a busca de dados da API
  useEffect(() => {
    const timer = setTimeout(() => {
      setPatients(MOCK_PATIENTS);
      setIsLoading(false);
    }, 500);
    return () => clearTimeout(timer);
  }, []);

  if (isLoading) {
    return <h1 className="p-6 text-2xl font-semibold">Carregando pacientes...</h1>;
  }

  return (
    // Container principal da página
    <div className="container mx-auto max-w-7xl p-6 py-10">
      {/* Título e Barra de Busca */}
      <div className="flex justify-between items-center mb-8">
        <h1 className="text-3xl font-bold text-foreground">
          Pacientes
        </h1>
        {/* Barra de Busca (como na imagem) */}
        <div className="relative w-full max-w-sm">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground" />
          <Input 
            placeholder="Buscar paciente..."
            className="pl-10" 
          />
        </div>
      </div>
      {/* Tabela de Pacientes (dentro de um Card) */}
      <Card>
        <CardContent className="p-0">
          {/* Usamos 'divs' para a tabela para total controlo com Tailwind */}
          <div className="overflow-x-auto">
            <div className="min-w-[1000px]"> {/* Garante que a tabela não quebra em ecrãs pequenos */}
              
              {/* Cabeçalho da Tabela */}
              <div className="grid grid-cols-7 gap-4 p-4 border-b border-border bg-muted/50">
                <span className="col-span-1 text-sm font-medium text-muted-foreground">Nome</span>
                <span className="col-span-1 text-sm font-medium text-muted-foreground">Data de Nascimento</span>
                <span className="col-span-1 text-sm font-medium text-muted-foreground">Gênero</span>
                <span className="col-span-1 text-sm font-medium text-muted-foreground">Telefone</span>
                <span className="col-span-1 text-sm font-medium text-muted-foreground">Email</span>
                <span className="col-span-2 text-sm font-medium text-muted-foreground">Ações</span>
              </div>

              {/* Linhas de Dados */}
              {patients.map(patient => (
                <div key={patient.id} className="grid grid-cols-7 gap-4 p-4 border-b border-border last:border-b-0 items-center">
                  <span className="col-span-1 font-medium text-foreground">{patient.name}</span>
                  <span className="col-span-1 text-muted-foreground text-sm">{patient.dob}</span>
                  <span className="col-span-1 text-muted-foreground text-sm">{patient.gender}</span>
                  <span className="col-span-1 text-muted-foreground text-sm">{patient.phone}</span>
                  <span className="col-span-1 text-muted-foreground text-sm">{patient.email}</span>
                  <div className="col-span-2 flex gap-4">
                    {/* Link "Ver Detalhes" - Usamos <Link> do TanStack Router */}
                    <Link
                      // No futuro, isto levará ao "Prontuário"
                      to="/patients/$patientId" 
                      params={{ patientId: String(patient.id) }}
                      className="text-sm font-medium text-primary hover:underline"
                    >
                      Ver Detalhes
                    </Link>
                    
                    {/* CORREÇÃO: Trocámos o <Link to="#"> por um <button>
                      Isto é semanticamente correto para uma ação (abrir modal)
                      e remove o erro do TanStack Router.
                    */}
                    <button
                      onClick={() => { /* Lógica para abrir o modal aqui */ }}
                      className="text-sm font-medium text-primary hover:underline"
                    >
                      Adicionar Anotação
                    </button>

                  </div>
                </div>
              ))}
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}

